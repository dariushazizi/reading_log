<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dariush Azizi's Reading Log</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Style for the modal backdrop */
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 max-w-6xl">

        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">My Reading Log</h1>
            <p class="text-slate-500 mt-2">Track your literary journey, one page at a time.</p>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-slate-700 border-b pb-2">Dashboard</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Total Books Read -->
                <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                    <div class="bg-blue-100 p-3 rounded-full"><i class="fas fa-book text-blue-500 text-2xl"></i></div>
                    <div>
                        <p class="text-slate-500 text-sm">Total Books</p>
                        <p id="total-books-stat" class="text-2xl font-bold">0</p>
                    </div>
                </div>
                <!-- Pages Read Today -->
                <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                    <div class="bg-green-100 p-3 rounded-full"><i class="fas fa-file-lines text-green-500 text-2xl"></i></div>
                    <div>
                        <p class="text-slate-500 text-sm">Pages Today</p>
                        <p id="pages-today-stat" class="text-2xl font-bold">0</p>
                    </div>
                </div>
                 <!-- Total Pages Read -->
                <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                    <div class="bg-yellow-100 p-3 rounded-full"><i class="fas fa-book-open text-yellow-500 text-2xl"></i></div>
                    <div>
                        <p class="text-slate-500 text-sm">Total Pages</p>
                        <p id="total-pages-stat" class="text-2xl font-bold">0</p>
                    </div>
                </div>
                <!-- Reading Streak -->
                <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4">
                    <div class="bg-purple-100 p-3 rounded-full"><i class="fas fa-fire text-purple-500 text-2xl"></i></div>
                    <div>
                        <p class="text-slate-500 text-sm">Current Streak</p>
                        <p id="streak-stat" class="text-2xl font-bold">0 Days</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytical Reports Section -->
        <section id="reports" class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-slate-700 border-b pb-2">Analytical Reports</h2>
            <div id="charts-container" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4">Pages Read Per Month</h3>
                    <div class="chart-container">
                        <canvas id="pages-per-month-chart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4">Book Reading Distribution</h3>
                    <div class="chart-container">
                        <canvas id="books-distribution-chart"></canvas>
                    </div>
                </div>
            </div>
             <p id="no-charts-message" class="hidden text-center text-slate-500 py-8 bg-white rounded-xl shadow-md">Log some reading sessions to see your analytical charts!</p>
        </section>

        <!-- Main Content Area: Form and History -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Log New Reading -->
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-xl shadow-md sticky top-8">
                    <h2 class="text-2xl font-semibold mb-4 text-slate-700">Log a Reading Session</h2>
                    <form id="reading-form" class="space-y-4">
                        <div>
                            <label for="book-title" class="block text-sm font-medium text-slate-600">Book Title</label>
                            <input type="text" id="book-title" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., The Lean Startup" required>
                        </div>
                        <div>
                            <label for="author" class="block text-sm font-medium text-slate-600">Author</label>
                            <input type="text" id="author" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Eric Ries">
                        </div>
                         <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="start-page" class="block text-sm font-medium text-slate-600">Start Page</label>
                                <input type="number" id="start-page" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" min="0" required>
                            </div>
                            <div>
                                <label for="end-page" class="block text-sm font-medium text-slate-600">End Page</label>
                                <input type="number" id="end-page" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" min="0" required>
                            </div>
                        </div>
                        <div>
                            <label for="reading-date" class="block text-sm font-medium text-slate-600">Date</label>
                            <input type="date" id="reading-date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label for="notes" class="block text-sm font-medium text-slate-600">Notes & Thoughts</label>
                            <textarea id="notes" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Any key takeaways or reflections..."></textarea>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-colors">
                            <i class="fas fa-save mr-2"></i>Save Reading
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Reading History -->
            <div class="lg:col-span-2">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-semibold mb-4 text-slate-700">Reading History</h2>
                    <div id="history-container" class="space-y-4">
                        <!-- Log entries will be inserted here by JavaScript -->
                         <p id="no-logs-message" class="text-center text-slate-500 py-8">No reading sessions logged yet. Use the form to get started!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Deletion Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm modal-content transform scale-95">
            <h3 class="text-lg font-bold text-slate-800">Confirm Deletion</h3>
            <p class="text-slate-600 mt-2">Are you sure you want to delete this reading log? This action cannot be undone.</p>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-delete-btn" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 transition">Cancel</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">Delete</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const readingForm = document.getElementById('reading-form');
            const historyContainer = document.getElementById('history-container');
            const noLogsMessage = document.getElementById('no-logs-message');
            const noChartsMessage = document.getElementById('no-charts-message');
            const chartsContainer = document.getElementById('charts-container');
            
            // Dashboard Stats Elements
            const totalBooksStat = document.getElementById('total-books-stat');
            const pagesTodayStat = document.getElementById('pages-today-stat');
            const totalPagesStat = document.getElementById('total-pages-stat');
            const streakStat = document.getElementById('streak-stat');

            // Modal Elements
            const deleteModal = document.getElementById('delete-modal');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            let logIdToDelete = null;

            // Chart Elements and Instances
            const pagesPerMonthCtx = document.getElementById('pages-per-month-chart').getContext('2d');
            const booksDistributionCtx = document.getElementById('books-distribution-chart').getContext('2d');
            let pagesPerMonthChart;
            let booksDistributionChart;

            // Set default date to today
            document.getElementById('reading-date').valueAsDate = new Date();

            // --- DATA HANDLING ---
            const getLogs = () => JSON.parse(localStorage.getItem('readingLogs')) || [];
            const saveLogs = (logs) => localStorage.setItem('readingLogs', JSON.stringify(logs));

            // --- UI RENDERING ---
            const renderLogEntry = (log) => {
                const pagesRead = log.endPage - log.startPage;
                const entryDiv = document.createElement('div');
                entryDiv.className = 'bg-slate-50 border border-slate-200 p-4 rounded-lg flex flex-col sm:flex-row justify-between sm:items-center';
                entryDiv.setAttribute('data-id', log.id);

                entryDiv.innerHTML = `
                    <div class="flex-grow">
                        <p class="font-bold text-lg text-slate-800">${log.bookTitle}</p>
                        <p class="text-sm text-slate-500">by ${log.author || 'Unknown Author'}</p>
                        <p class="text-sm text-slate-600 mt-2">Read pages ${log.startPage} to ${log.endPage} (${pagesRead} pages)</p>
                        ${log.notes ? `<p class="text-sm text-slate-600 mt-1 bg-slate-100 p-2 rounded-md"><em>${log.notes}</em></p>` : ''}
                    </div>
                    <div class="text-sm text-slate-500 mt-3 sm:mt-0 sm:text-right flex-shrink-0">
                        <p>${new Date(log.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <button class="delete-btn text-red-500 hover:text-red-700 mt-2 transition-colors" data-id="${log.id}">
                            <i class="fas fa-trash-alt mr-1"></i>Delete
                        </button>
                    </div>
                `;
                return entryDiv;
            };

            const renderAllLogs = () => {
                historyContainer.innerHTML = ''; 
                const logs = getLogs();

                if (logs.length === 0) {
                    historyContainer.appendChild(noLogsMessage);
                    noLogsMessage.style.display = 'block';
                    chartsContainer.classList.add('hidden');
                    noChartsMessage.classList.remove('hidden');
                } else {
                    noLogsMessage.style.display = 'none';
                    chartsContainer.classList.remove('hidden');
                    noChartsMessage.classList.add('hidden');
                    logs.sort((a, b) => new Date(b.date) - new Date(a.date));
                    logs.forEach(log => historyContainer.appendChild(renderLogEntry(log)));
                }
                updateDashboard();
                updateCharts();
            };

            // --- DASHBOARD LOGIC ---
            const updateDashboard = () => {
                const logs = getLogs();
                
                const uniqueBooks = new Set(logs.map(log => log.bookTitle.toLowerCase().trim()));
                totalBooksStat.textContent = uniqueBooks.size;

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const pagesToday = logs
                    .filter(log => new Date(log.date).setHours(0, 0, 0, 0) === today.getTime())
                    .reduce((sum, log) => sum + (log.endPage - log.startPage), 0);
                pagesTodayStat.textContent = pagesToday;

                const totalPages = logs.reduce((sum, log) => sum + (log.endPage - log.startPage), 0);
                totalPagesStat.textContent = totalPages;

                const readingDates = [...new Set(logs.map(log => new Date(log.date).setHours(0,0,0,0)))].sort((a, b) => b - a);
                let streak = 0;
                if (readingDates.length > 0) {
                    const todayTime = new Date().setHours(0,0,0,0);
                    const yesterdayTime = new Date(todayTime).setDate(new Date(todayTime).getDate() - 1);
                    if (readingDates[0] === todayTime || readingDates[0] === yesterdayTime) {
                        streak = 1;
                        for (let i = 0; i < readingDates.length - 1; i++) {
                            if (readingDates[i] - readingDates[i+1] === 86400000) streak++;
                            else break;
                        }
                    }
                }
                streakStat.textContent = `${streak} Day${streak !== 1 ? 's' : ''}`;
            };

            // --- CHART LOGIC ---
            const updateCharts = () => {
                const logs = getLogs();

                // Destroy existing charts to prevent duplicates
                if (pagesPerMonthChart) pagesPerMonthChart.destroy();
                if (booksDistributionChart) booksDistributionChart.destroy();

                if (logs.length === 0) return;

                // 1. Pages Per Month Chart
                const monthlyData = {};
                logs.forEach(log => {
                    const month = new Date(log.date).toISOString().slice(0, 7); // YYYY-MM
                    const pages = log.endPage - log.startPage;
                    monthlyData[month] = (monthlyData[month] || 0) + pages;
                });
                
                const sortedMonths = Object.keys(monthlyData).sort();
                const monthLabels = sortedMonths.map(month => new Date(month + '-02').toLocaleString('default', { month: 'short', year: '2-digit' }));
                const monthPageData = sortedMonths.map(month => monthlyData[month]);

                pagesPerMonthChart = new Chart(pagesPerMonthCtx, {
                    type: 'bar',
                    data: {
                        labels: monthLabels,
                        datasets: [{
                            label: 'Pages Read',
                            data: monthPageData,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });

                // 2. Books Distribution Chart
                const bookData = {};
                logs.forEach(log => {
                    const title = log.bookTitle;
                    const pages = log.endPage - log.startPage;
                    bookData[title] = (bookData[title] || 0) + pages;
                });

                const bookLabels = Object.keys(bookData);
                const bookPageData = Object.values(bookData);
                
                booksDistributionChart = new Chart(booksDistributionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: bookLabels,
                        datasets: [{
                            label: 'Pages per Book',
                            data: bookPageData,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)', 'rgba(54, 162, 235, 0.7)', 'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)', 'rgba(153, 102, 255, 0.7)', 'rgba(255, 159, 64, 0.7)'
                            ],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            };

            // --- EVENT LISTENERS ---
            readingForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const startPage = parseInt(document.getElementById('start-page').value);
                const endPage = parseInt(document.getElementById('end-page').value);

                if (endPage <= startPage) {
                    // Using a custom modal or inline message would be better, but alert is simple for now.
                    alert('End page must be greater than the start page.');
                    return;
                }

                const newLog = {
                    id: Date.now(),
                    bookTitle: document.getElementById('book-title').value.trim(),
                    author: document.getElementById('author').value.trim(),
                    startPage: startPage,
                    endPage: endPage,
                    date: document.getElementById('reading-date').value,
                    notes: document.getElementById('notes').value.trim(),
                };

                const logs = getLogs();
                logs.push(newLog);
                saveLogs(logs);

                renderAllLogs();
                readingForm.reset();
                document.getElementById('reading-date').valueAsDate = new Date();
            });

            historyContainer.addEventListener('click', (e) => {
                if (e.target.closest('.delete-btn')) {
                    logIdToDelete = e.target.closest('.delete-btn').dataset.id;
                    openModal();
                }
            });

            const openModal = () => {
                deleteModal.classList.remove('hidden');
                setTimeout(() => {
                    deleteModal.querySelector('.modal-backdrop').classList.remove('opacity-0');
                    deleteModal.querySelector('.modal-content').classList.remove('scale-95');
                }, 10);
            }

            const closeModal = () => {
                deleteModal.querySelector('.modal-backdrop').classList.add('opacity-0');
                deleteModal.querySelector('.modal-content').classList.add('scale-95');
                setTimeout(() => {
                    deleteModal.classList.add('hidden');
                    logIdToDelete = null;
                }, 300);
            }

            confirmDeleteBtn.addEventListener('click', () => {
                if (logIdToDelete) {
                    let logs = getLogs();
                    logs = logs.filter(log => log.id != logIdToDelete);
                    saveLogs(logs);
                    renderAllLogs();
                }
                closeModal();
            });

            cancelDeleteBtn.addEventListener('click', closeModal);
            deleteModal.addEventListener('click', (e) => e.target === deleteModal && closeModal());

            // --- INITIAL LOAD ---
            renderAllLogs();
        });
    </script>

</body>
</html>
